{% extends 'base.html' %} {% block title %}Comprobante de Atraso{% endblock %}
{% block content %}
<div class="container mt-5">
  <div class="border p-4 bg-white shadow-sm">
    <h2 class="text-center mb-4 border-bottom pb-3">COMPROBANTE DE ATRASO</h2>

    <div class="row mb-2">
      <div class="col-12">
        <strong>Estudiante:</strong> {{ atraso.estudiante.nombre }}
      </div>
    </div>

    <div class="row mb-2">
      <div class="col-12">
        <strong>RUT:</strong> {{ atraso.estudiante.rut }}
      </div>
    </div>

    <div class="row mb-2">
      <div class="col-12">
        <strong>Curso:</strong> {{ atraso.estudiante.curso }}
      </div>
    </div>

    <div class="row mb-2">
      <div class="col-12"><strong>Fecha:</strong> {{ atraso.fecha }}</div>
    </div>

    <div class="row mb-2">
      <div class="col-12"><strong>Hora:</strong> {{ atraso.hora }}</div>
    </div>

    <div class="row mb-2">
      <div class="col-12">
        <strong>Estado:</strong> {% if atraso.justificado %}Justificado
        {%else%}No Justificado{% endif%}
      </div>
    </div>

    {% if atraso.observacion %}
    <div class="row mb-2">
      <div class="col-12">
        <strong>Observación:</strong> {{ atraso.observacion }}
      </div>
    </div>
    {% endif %}
  </div>
</div>

<style>
  /* Estilos específicos para tablets */
  @media (min-width: 768px) and (max-width: 1024px) {
    .container {
      max-width: 600px;
    }
    h2 {
      font-size: 2.2rem;
    }
    .row {
      font-size: 1.1rem;
    }
  }

  /* Estilos para impresión - mantener formato de ticket */
  @media print {
    /* Ocultar header completo */
    header,
    .header,
    .navbar,
    nav {
      display: none !important;
    }

    /* Ocultar sidebar */
    .sidebar,
    .side-nav,
    .offcanvas {
      display: none !important;
    }

    /* Ocultar elementos de navegación */
    .navbar-brand,
    .navbar-toggler,
    .hamburger {
      display: none !important;
    }

    body {
      margin: 0 !important;
      padding: 0 !important;
      margin-top: 0 !important;
      padding-top: 0 !important;
      font-family: "Courier New", monospace;
      font-size: 18px;
      line-height: 1.5;
    }
    .container {
      max-width: none;
      margin: 0 !important;
      padding: 0 !important;
      margin-top: 0 !important;
      padding-top: 0 !important;
    }
    .border {
      border: none !important;
      box-shadow: none !important;
    }
    .bg-white {
      background: white !important;
    }
    .shadow-sm {
      box-shadow: none !important;
    }
    .voucher {
      width: 80mm;
      padding: 0;
      margin: 0;
      border: 1px solid #000;
    }
    .header {
      text-align: center;
      border-bottom: 1px solid #000;
      padding-bottom: 0;
      margin-bottom: 0;
    }
    .title {
      font-size: 20px;
      font-weight: bold;
      margin: 0;
    }
    .info-row {
      margin: 0;
    }
    .label {
      font-weight: bold;
      display: inline-block;
      width: 25mm;
    }
    .value {
      display: inline-block;
    }
    .footer {
      text-align: center;
      margin-top: 0;
      padding-top: 0;
      border-top: 1px solid #000;
      font-size: 16px;
    }
    @page {
      size: 90mm auto;
      margin: 0;
    }

    /* Ocultar elementos de Bootstrap en impresión */
    .row {
      display: block !important;
    }
    .col-md-3,
    .col-md-9,
    .col-sm-4,
    .col-sm-8,
    .col-12 {
      display: block !important;
      width: 100% !important;
      flex: none !important;
    }
    .col-md-3,
    .col-sm-4 {
      width: 25mm !important;
      font-weight: bold;
      display: inline-block !important;
    }
    .col-md-9,
    .col-sm-8 {
      width: calc(100% - 25mm) !important;
      display: inline-block !important;
    }
    h2 {
      font-size: 20px !important;
      margin: 0 !important;
      padding: 0 !important;
      border: none !important;
    }
    .mb-2 {
      margin-bottom: 0 !important;
    }
    .mb-4 {
      margin-bottom: 0 !important;
    }
    .mt-4 {
      margin-top: 0 !important;
    }
    .pt-3 {
      padding-top: 0 !important;
    }
    .pb-3 {
      padding-bottom: 0 !important;
    }
    .p-4 {
      padding: 0 !important;
    }
    .text-center {
      text-align: center !important;
    }
    .text-muted {
      color: black !important;
    }
    .border-top {
      border-top: 1px solid #000 !important;
    }
    .border-bottom {
      border-bottom: 1px solid #000 !important;
    }
  }
</style>
{% endblock %} {% block extra_js %}
<script>
  // Función para redirigir según el origen
  function redirigirSegunOrigen() {
    console.log("Intentando redirigir...");

    // Obtener el parámetro de origen de la URL
    const urlParams = new URLSearchParams(window.location.search);
    const origen = urlParams.get("origen");

    console.log("Origen detectado:", origen);

    if (origen === "crear") {
      console.log("Redirigiendo al formulario de crear...");
      window.location.replace("{% url 'atrasos:create' %}");
    } else if (origen === "list") {
      console.log("Redirigiendo al listado...");
      window.location.replace("{% url 'atrasos:list' %}");
    } else {
      console.log(
        "Origen no reconocido, redirigiendo al listado por defecto..."
      );
      window.location.replace("{% url 'atrasos:list' %}");
    }
  }

  // Evento cuando se completa la impresión
  window.addEventListener("afterprint", function () {
    console.log("Evento afterprint detectado");
    redirigirSegunOrigen();
  });

  // Función para manejar la impresión y redirección
  function imprimirYRedirigir() {
    console.log("Iniciando proceso de impresión...");

    // Imprimir el documento
    window.print();

    // Fallback: si afterprint no funciona, usar timeout después de 2 segundos
    setTimeout(function () {
      console.log("Fallback: redirigiendo por timeout");
      redirigirSegunOrigen();
    }, 2000);
  }

  // Ejecutar cuando el documento esté completamente cargado
  document.addEventListener("DOMContentLoaded", function () {
    console.log("DOM cargado, iniciando proceso...");
    // Pequeño delay para asegurar que la página esté lista
    setTimeout(function () {
      imprimirYRedirigir();
    }, 500);
  });
</script>
{% endblock %}
